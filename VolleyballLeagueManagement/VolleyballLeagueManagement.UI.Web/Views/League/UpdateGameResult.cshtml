@model VolleyballLeagueManagement.League.Contracts.ViewModels.GameViewModel
@Html.HiddenFor(model => model.GameId, new { @id = "gameId" })

<h4>
    Zmiana wyniku spotkania
</h4>
<hr />

<div class="col-md-offset-1 col-md-10">
    <div class="jumbotron" id="set1" style="background-color: dimgrey">
        <h4 style="margin: -15px 0 15px 0">
            Set 1
        </h4>
        <div class="col-md-offset-1 col-md-12">
            <div class="col-md-6" style="text-align: right">
                @Model.FirstTeamName
                <input type="number" id="firstTeamPoints1" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                :
                <input type="number" id="secondTeamPoints1" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                @Model.SecondTeamName
            </div>
            <div class="col-md-6">
                <p style="font-size: 14px; position: relative; top: 7px">Czas trwania:</p>
                <div class="input-group" style="width: 100px; position: relative; bottom: 35px; left: 100px">
                    <span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-time"></span></span>
                    <input type="number" id="duration1" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                </div>
            </div>
        </div>
    </div>

    <div class="jumbotron" id="set2" style="background-color: dimgrey; display: none">
        <h4 style="margin: -15px 0 15px 0">
            Set 2
        </h4>
        <div class="col-md-offset-1 col-md-12">
            <div class="col-md-6" style="text-align: right">
                @Model.FirstTeamName
                <input type="number" id="firstTeamPoints2" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                :
                <input type="number" id="secondTeamPoints2" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                @Model.SecondTeamName
            </div>
            <div class="col-md-6">
                <p style="font-size: 14px; position: relative; top: 7px">Czas trwania:</p>
                <div class="input-group" style="width: 100px; position: relative; bottom: 35px; left: 100px">
                    <span class="input-group-addon" ><span class="glyphicon glyphicon-time"></span></span>
                    <input type="number" id="duration2" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                </div>
            </div>
        </div>
    </div>

    <div class="jumbotron" id="set3" style="background-color: dimgrey; display: none">
        <h4 style="margin: -15px 0 15px 0">
            Set 3
        </h4>
        <div class="col-md-offset-1 col-md-12">
            <div class="col-md-6" style="text-align: right">
                @Model.FirstTeamName
                <input type="number" id="firstTeamPoints3" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                :
                <input type="number" id="secondTeamPoints3" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                @Model.SecondTeamName
            </div>
            <div class="col-md-6">
                <p style="font-size: 14px; position: relative; top: 7px">Czas trwania:</p>
                <div class="input-group" style="width: 100px; position: relative; bottom: 35px; left: 100px">
                    <span class="input-group-addon" id="basic-addon3"><span class="glyphicon glyphicon-time"></span></span>
                    <input type="number" id="duration3" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                </div>
            </div>
        </div>
    </div>

    <div class="jumbotron" id="set4" style="background-color: dimgrey; display: none">
        <h4 style="margin: -15px 0 15px 0">
            Set 4
        </h4>
        <div class="col-md-offset-1 col-md-12">
            <div class="col-md-6" style="text-align: right">
                @Model.FirstTeamName
                <input type="number" id="firstTeamPoints4" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                :
                <input type="number" id="secondTeamPoints4" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                @Model.SecondTeamName
            </div>
            <div class="col-md-6">
                <p style="font-size: 14px; position: relative; top: 7px">Czas trwania:</p>
                <div class="input-group" style="width: 100px; position: relative; bottom: 35px; left: 100px">
                    <span class="input-group-addon" id="basic-addon4"><span class="glyphicon glyphicon-time"></span></span>
                    <input type="number" id="duration4" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                </div>
            </div>
        </div>
    </div>

    <div class="jumbotron" id="set5" style="background-color: dimgrey; display: none">
        <h4 style="margin: -15px 0 15px 0">
            Set 5
        </h4>
        <div class="col-md-offset-1 col-md-12">
            <div class="col-md-6" style="text-align: right">
                @Model.FirstTeamName
                <input type="number" id="firstTeamPoints5" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                :
                <input type="number" id="secondTeamPoints5" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                @Model.SecondTeamName
            </div>
            <div class="col-md-6">
                <p style="font-size: 14px; position: relative; top: 7px">Czas trwania:</p>
                <div class="input-group" style="width: 100px; position: relative; bottom: 35px; left: 100px">
                    <span class="input-group-addon" id="basic-addon5"><span class="glyphicon glyphicon-time"></span></span>
                    <input type="number" id="duration5" class="form-control" style="display: inline; color: black; width: 70px" value="0" min="0" max="50">
                </div>
            </div>
        </div>
    </div>

    <div class="form group row col-md-2">
        <button id="AddSet" class="btn btn-primary">
            <span class="glyphicon glyphicon-plus"></span> Dodaj set
        </button>
    </div>

    <div class="form group row col-md-2">
        <button id="UpdateResult" class="btn btn-success">
            Zapisz
        </button>
    </div>

    <div class="form group row col-lg-10" style="margin-top: 15px">
        @Html.ActionLink("Powrót do kalendarza", "EditCalendar")
    </div>
</div>
<div class="row"></div>

<script>
    $('#AddSet').click(addSet);
    $('#UpdateResult').click(updateResult);

    function addSet() {
        addSet.count = ++addSet.count || 2;

        if (addSet.count <= 5) {
            var templateId = '#set' + addSet.count;
            $(templateId).css('display', '');
        }
        if (addSet.count === 5) {
            $('#AddSet').attr('disabled', true);
        }
    }

    function updateResult() {
        var sets = [];
        var firstTeamTemplateId = '#firstTeamPoints';
        var secondTeamTemplateId = '#secondTeamPoints';
        var durationTemplateId = '#duration';

        for (var i = 1; i <= 5; i++) {
            var isVisible = $(firstTeamTemplateId + i).parent().parent().parent().css('display') !== 'none';
            if (isVisible) {
                sets.push({
                    firstTeamPoints: $(firstTeamTemplateId + i).val(),
                    secondTeamPoints: $(secondTeamTemplateId + i).val(),
                    durationInMinutes: $(durationTemplateId + i).val(),
                    number: i
            });
            }
        }

        var gameId = $('#gameId').val();
        sendData(gameId, sets);
    }

    function sendData(gameId, sets) {
        console.log(gameId);
        console.log(sets);
        $.ajax({
            url: "/League/UpdateGameResult/",
            type: "POST",
            data: {
                command: {
                    GameId: gameId,
                    Sets: sets
                }
            },
            success: function (data) {
                console.log("udalo sie!");
            },
            error: function (err) {
                console.log(err);
            }
        });
    }
</script>

@*TODO MVP*@

